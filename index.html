<html>
        <head><title>ctx 2D vector renderering framework</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

        <style type='text/css'>
          @import url(ctx.css);
        </style>
      </head>

    <body>
       <div id='menu'>
                <a href='http://ctx.graphics/'>ctx</a>
                <a href='#code'>code</a>
                <a href='#example'>hello world</a>
                <br/>
                <a href='#codesize'>codesize</a>
                <a href='rasterizer/'>rasterizer</a>
                <a href='protocol/'>protocol</a>
                <a href='#roadmap'>roadmap</a>
                <a href='#license'>license</a>
                <br/>
                <a href='mcu/'>videos</a>
                <a href='tests/'>tests</a>
                <a href='glitch/'>glitch</a>
        </div>

              <div id='page'>
        <img style='max-width:100%' src='tests/png-640x240/ctx.png'/>

        <p>ctx is a 2D vector graphics framework, <a href='protocol/'>text
        protocol</a>, library and <a href='rasterizer/'>rasterizer</a> 
        built around the HTML5 Canvas 2D context. It can render interactive
        resolution independent antialiased interfaces on <a
        href='mcu/'>microcontrollers</a> and handle CMYK as well as do remote
        interactive vector graphics as a <a href='terminal/'>terminal</a>
        extension.
        </p>

        <h3 id='code'>Code</h3>

        <p>The direct links below correspond to the latest commit <a
                href='log.html'>in git</a>.</p>

        <table>
                <tr><td style='width:14em'><a href='ctx.h'>ctx.h</a> <a href='ctx.h.html'>(browse)</td><td>580K</td><td>The singleheader library ctx.</tr>
                <tr><td><a href='ctx-font-ascii.h'>ctx-font-ascii.h</a> <a href='ctx-font-regular.h.html'>(browse)</td><td>72K</td><td>Example font to use with ctx, containing only ASCII</td></tr>
                <tr><td><a href='ctx-font-regular.h'>ctx-font-regular.h</a> <a href='ctx-font-regular.h.html'>(browse)</td><td>128K</td><td>Example font to use with ctx</td></tr>
                                        <tr><td><a href='hello.c'>hello.c</a></td><td>3K</td><td>Animated terminal test.</tr>
                                        <tr><td><a href='test-size.c'>test-size.c</a></td><td>3K</td><td>example</td></tr>
        </table>


        <p>SVG and PDF output can be generated with the <a
                                                                href='https://cairographics.org/'>cairo</a>
        renderer, which becomes available if cairo.h is included before
        ctx.h</p>
        

<h2 id='license'>license and funding</h2>
<p>
ctx is available under <a href='https://www.gnu.org/licenses/lgpl-3.0.en.html'>LGPLv3+</a> you can encourage continued
development of ctx and dissimilar technologies by financially supporting its developer,
if the <a href='https://pippin.gimp.org/'>authors</a> income through  <a href='https:/pippin.gimp.org/funding/'>patreon</a> and similar is above 4000USD per month for a year, or a similar amount
in shorter time, ctx will be relicensed under the <a href='https://opensource.org/licenses/ISC'>ISC license</a>.
</p>

        <h2 id='standards'>standards</h2>
        <p>The implementation of ctx uses the <a href='https://html.spec.whatwg.org/#2dcontext'>HTML5 2d context</a> as the primary reference, The
        compositing is according to <a
        href='https://drafts.fxtf.org/compositing/'>Compositing and Blending
Level 2</a>; though ctx permits any combination of compositing and blending
mode. The core ideas for a 2d vector vocabulary is however shared with PDF,
cairo, OpenVG, directdraw and other API that have foundation in postscript.
        </p>

<h2 id='codesize'>optimization vs binary size</h2>

<p>ctx is designed from the beginning to act as a software GPU for modern
microcontrollers, some of which are more powerful than the PCs in the mid 90s.
Different optimization settings of the compiler give a wide range for the
performance/binary size tradeoff. But the small footprint in RAM and ability to
use a shared read-only display list makes the ctx rasterizer core also useful
in multi-threaded rendering.</p>

<pre>
font data size:    12186 bytes (A sans font subsetted to only ASCII)
RGBA8 rasterizer:  38869 bytes (-Os ~38kb - with many features disabled ~30kb
                                -O0  90-631kb
                                -O2  57-114kb
                                -Ofast/-O3  76-181kb, size bump due to
                                SIMD tree-vectorizer)

ctx parser:        20512 bytes (not needed for direct use from C, but also
                                on embedded this can be useful for ease of
                                integration with other languages or directly
                                using ctx+mictrocontroller+display as a serial
                                display.)
</pre>

<p>
Even more agressive optimization with exponential compile time has been tested
by forcing inlining and separate compilation of all combinations of blend,
composite and image source modes - building ctx then takes 5-6minutes and
the resulting binary is close to a megabyte, performance gains exist but
in practice they are near neglible.</p>

<p>The total RAM requirements are modest, with a slim configuration &lt;16kb of
RAM is required when directly rendering using the default limits, by reducing
the number of save/restore states handled and the complexity of the path
rendered, RAM requirement can be reduced to ~6kb.</p>




        <h2 id='roadmap'>semi-ordered roadmap / wishlist</h2>
	<ul>
        <li>reduce size and improve performance</li>
        <li>Document/clean up network transparent UI protocol using ctx
            syntax. (<a href='not-really-a-demo.png'>test</a>, <a href='multi-client.png'>test</a>)</li>
        <li>swap uses of cairo in <a href='http://gegl.org'>GEGL</a> with ctx</li>
	<li>point in fill/stroke, (current in_fill API uses path boundingbox)</li>
        <li>texture upload as part of ctx syntax</li>
        <li>ICC color management (provisions have been made in the API for this,
                but RGBtoRGB and CMYKtoRGB RGBtoCMYK conversions are currently
                done naively, instead of using <a href='http://gegl.org/babl/'>babl</a>.)</li>
        <li>websockets + js + HTML5 Canvas renderer</li>
        <li>(optional) use of floating point instead of fixed point in rasterizer.</li>
	<li>glyph fallback</li>
        <li>faster 1d-gaussian blur for shadow blur</li>
	<li>gradients: use both circle centers</li>
        <li>bindings to a javascript engine, for running canvas js content as
            apps.</li>
        <li>stroking
          <ul>
            <li>reimplement as a stroke_to_path</li>
	    <li>miter limit (unless round joins are used, all corners are mitered now)</li>
            <li>dash pattern</li>
          </ul>
        </li>
        <li>SVG/HTML parser renderer (in progress, from mrg)</li>
        <li>PDF/SVG generation (can already be done through cairo integration)</li>
        <li>Add API for integrating device-N with RGB/CMYK through <a href='http://pippin.gimp.org/color-simulator/'>coloritto</a></li>
        <li>32bit float coverage from rasterizer - right now we support 32f images; but composite them with 8bit alpha masks.</li>
        <li>More SIMD code (the common RGBA8 cases for AVX2 are the only bit
            covered thus far, for floating point formats making the
            existing code more autovectorizer friendly is a priority.)</li>
        <li>A GPU renderer, using pathfinder or similar HTML5 2d canvas capable
                library.
        </li>
	</ul>

        <h3 id='example'>example code</h3>
<pre>

#include &lt;stdint.h&gt;

#include "<a href='ctx-font-regular.h'>ctx-font-regular.h</a>"

#define CTX_IMPLEMENTATION

#include "<a href='ctx.h'>ctx.h</a>"

#define WIDTH    72
#define HEIGHT   24

uint8_t pixels[WIDTH*HEIGHT*4];

int main (int argc, char **argv)
{
  char *utf8 = "hello\nctx\n";
  Ctx *ctx = ctx_new_for_framebuffer (
    pixels, WIDTH, HEIGHT, WIDTH*4,
    CTX_FORMAT_RGBA8);

  ctx_rgba        (ctx, 0.5, 0.5, 0.5, 1);
  ctx_rectangle   (ctx, 0, 0, 80, 24);
  ctx_fill        (ctx);
  ctx_move_to     (ctx, 10, 9);
  ctx_font_size   (ctx, 12);
  ctx_line_width  (ctx, 2);
  ctx_rgba        (ctx, 0, 0, 0, 1);
  ctx_text_stroke (ctx, utf8);
  ctx_rgba        (ctx, 1,0, 1.0, 1.0, 1.0);
  ctx_move_to     (ctx, 10, 9);
  ctx_text        (ctx, utf8);
  ctx_free        (ctx);

  static char *utf8_gray_scale[]={" ","░","▒","▓","█","█", NULL};
  int no=0;
  for (int y= 0; y &lt; HEIGHT; y++)
  {
    for (int x = 0; x &lt; WIDTH; x++, no+=4)
      printf ("%s", utf8_gray_scale[5-(int)CTX_CLAMP(pixels[no+1]/255.0*6.0, 0, 5)]);
    printf ("\n");
  }

  return 0;
}
</pre>
which outputs (the rightmost column of pixels is a bug):
<pre>
~/src/ctx/tests$ ./test-size 
▓▓▓▓▓▓▓▓▓▓▓█▓▓▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓██▓▓█ █▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓██ ██████████▓██▓▓▓██▓▓██▓████▓▓█████▒███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓█░  ░█ ██░░ ░██ █▓█ █   ▓█▒  ███   ▓▓   █▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓██ ███ ██ ▓█░██░███░█▓▓██▓░██░██░████▒███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█ █▓█ ██░██▓▓█▓▒█▒▓█▓▒██░▓██░▓█ ▓███▒██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█ █▓█ ██░██▓▓██ █ ██▓▓██░▒▓▓▓███▒░▒█▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█ ███ ██░██▓▓██▒░▒██▓▓██▒▒████████░█▒███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█▒░▒█ ██░██▓▓██▓ █▓██░░██░░▒░█▓░▒░▓██░░█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓█████▓██▓▓██▓██ █▓▓████▓██████████▓████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓ █▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█ █▓▓▓▓▓▓▓▓▓▓▓▓▓██░░█▓▓▓▓▓▓▓▓▓▓▓█▒▓█▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓████▓▓▓█████ ███▓▓▓████▓▓▓▓█░███████▓▓████▓█▒▓███▓▓████▓▓████
▓▓▓▓▓▓▓▓▓▓██▒▒▓███   ▓█ ▒ ░█▓█▒  ██▓▓█▒  ░█▓  ████  ▒██▒░  ███   ▓██   █
▓▓▓▓▓▓▓▓▓██░██▒██▒▓████ ▓█▒▓█▓▒██░█▓▓██░███░██░██░██▒▓█▒░██░█████░██████
▓▓▓▓▓▓▓▓▓█▓▒██▓▒█ █▓▓▓█ ███▒█░███░█▓▓▓█░██▓▓██▓▓█ ███░█▒▓██▒███▓▓░▓███░█
▓▓▓▓▓▓▓▓▓█▓▒█████ █▓▓▓█ ███▒█░█▓█░█▓▓▓█░██▒▓██▓▓█░███░█▒▓██▒▓█ ██▒▓██░▓█
▓▓▓▓▓▓▓▓▓█▓░█████░█████ ███▒█░▓██ █▓▓▓█░██▓░██░██ ██▓░█▒▒██░██░██░▓█▒▒██
▓▓▓▓▓▓▓▓▓▓█▓░▒░▓██ ▒░██ ███▒██░░ ▓█▓▓▓█░█▓█▒  ▒██▓ ░░██▒░▒░▒██░░░▒▓█ ▒▒█
▓▓▓▓▓▓▓▓▓▓▓█████▓███████▓▓██▓▓████▓▓▓▓▓██▓▓████▓▓████▓██████▓▓██████████
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
</pre>

<p>To fetch, build, and run ctx, and an example similar to the above
run the following:

<pre>
mkdir foo;cd foo;wget http://ctx.graphics/{ctx.h,ctx-font-regular.h,hello.c};make hello &amp;&amp; ./hello</pre>
</p>
              </div>
      </body>
</html>
