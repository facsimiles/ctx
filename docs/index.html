<html>
  <head><title>ctx - vectors over the wire</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type='text/css'>
      @import url(ctx.css);
    </style>
  </head>

    <body>
       <div id='menu'>
                <a href='http://ctx.graphics/'>ctx</a>
                <a href='#downloads'>downloads</a>
                <a href='#example'>hello world</a>
                <br/>
                <a href='rasterizer/'>rasterizer</a>
                <a href='protocol/'>protocol</a>
                <a href='#roadmap'>roadmap</a>
                <a href='#license'>license</a>
                <br/>
                <a href='mcu/'>videos</a>
                <a href='tests/'>tests</a>
                <a href='glitch/'>glitch</a>
        </div>

        <div id='page'>
        <img style='max-width:100%' src='tests/png-640x240/ctx.png'/>

        <p>ctx is an experimental terminal, single header library and <a
           href='protocol/'>serial protocol</a>/terminal extension
         for interactive vector graphics.</p>

        <img style='max-width:100%' src='terminal.png'/>

        <dl>
           <dt><a href='https://html.spec.whatwg.org/#2dcontext'>HTML5 Canvas 2D Context</a></dt><dd>Easily bindable C API and protocol builds directly on this standard.
        Compositing and blending is according to <a
        href='https://drafts.fxtf.org/compositing/'>Compositing and Blending
Level 2</a>; ctx goes further than the standard and permits all blending modes
to be combined with all compositing modes.  The core ideas for a 2d vector
vocabulary is however shared with PDF, cairo, OpenVG, directdraw and other API
that have foundation in postscript.

           </dd>

           <dt>Small footprint</dt><dd>Can be tuned for <a
                   href='mcu/'>microcontrollers</a> down to ~5kb of RAM + 30kb
           of code + 12kb of fontdata, combined with immediate mode UI that can
           be re-run, it is sufficient to have a framebuffer covering one
           scanline - making microcontrollers with 8kb of RAM a possible
           target - this has not yet been attempted.</dd>

           <dt>Threaded/deferred rendering</dt><dd>The compact ctx protocol - in both text and binary form - can split the drawing from the renderering. 
           Separate render threads each with a small RAM footprint can
           render shared read-only from the binary representation. The
           binary representation is also suitable for driving other backends
           like cairo or an external GPU renderer.
           .</dd>

           <dt>utf8 native</dt><dd>Missing ligratures though, and beyond vttest
           charset support is not good and RTL is missing - harfbuzz
           intergration can fix this and more. Also currently lacking color
           emoji. The most efficient font format is the binary
           representation of the ctx protocol.</dd>

           <dt>stb_truetype.h</dt><dd>If the declarations for stb_truetype are
           included before ctx.h - functions to load fonts from TTF/OTF files
           become available.</dd>

           <dt>VT4xx, ECMA-48</dt><dd>Almost full vt100 and vt220 <a href='terminal/escape-sequences.html'>escape sequence handling</a>, some of horizontal margins are supported, including smooth scroll and double width/height. From
           ECMA-48 and xterm handling of colors, word-wrap, proportional text, mouse and more.</dd>
           <dt><a href='https://pippin.gimp.org/ametameric/'>ametmeric palette</a></dt>
                <dd>The terminal 16 color palette is optimized for legibility for both trichromats and dichromats</dd>
     <dt><a href='https://github.com/hodefoting/atty/'>atty</a></dt>
                <dd>audio recording and playback (only raw pcm for now, opus codec NYI)</dd>
                <dt><a href='https://en.wikipedia.org/wiki/Sixel'>sixels</a></dt><dd>DEC terminal family standard for raster graphics transfer</dd>
                <dt><a href='https://sw.kovidgoyal.net/kitty/graphics-protocol.html'>kitty graphics</a></dt><dd>kitty style raster graphics transfer</dd> 
                <dt><a href='https://iterm2.com/documentation-images.html'>iterm2 inline images</a></dt><dd>iterm2 style raster grarphics transfer</dd>

           <dt>bracketed paste</dt>

           <dt>SDL2</dt><dd>Optional backend that works better than the framebuffer that gets included when SDL.h is included before ctx.h</dd>

           <dt><a href='https://cairographics.org/'>cairo</a></dt><dd>support code to render to cairo contexts if cairo.h is included before ctx.h, useful for conformance verfication and SVG and PDF output.</dd>

           <dt>/dev/fb0</dt><dd>Applications built with the ctx library can run
           directly on the linux framebuffer without X/wayland, for it to be
           fast a fast framebuffer is needed. 
           </dd>

           <dt>RGB and CMYK, 8pc and 32bit floating point</dt><dd>Already supporting RGB332, 565 and grayscale modes, with an architecture that also can support spectral, ICC integration is planned for.</dd>
        </dl>

        <h3 id='downloads'>Downloads</h3>

        <p>There is no tarball releases yet, but the development version
        can be cloned and contains some example/test clients in C and bash,
        if you've got the development headers for SDL2 the following
        builds a ctx binary.
        </p>
        <pre>$ git clone <a href='https://ctx.graphics/.git'>https://ctx.graphics/.git</a>
$ cd ctx.graphics
$ make</pre>

        <table>
                <tr><td style='width:14em'><a href='ctx.h'>ctx.h</a> <a href='ctx.h.html'>(browse)</td><td>580K</td><td>The singleheader library ctx.</tr>
                <tr><td><a href='ctx-font-ascii.h'>ctx-font-ascii.h</a> <a href='ctx-font-regular.h.html'>(browse)</td><td>72K</td><td>Example font to use with ctx, containing only ASCII</td></tr>
                <tr><td><a href='ctx-font-regular.h'>ctx-font-regular.h</a> <a href='ctx-font-regular.h.html'>(browse)</td><td>128K</td><td>Example font to use with ctx</td></tr>
                <tr><td><a href='test-size.c'>test-size.c</a></td><td>3K</td><td>example</td></tr>
                <tr><td><a href='binaries/ctx-x86_64-SDL2'>ctx-x86_64-SDL2</a><td>400kb (packed with UPX)</td><td>ELF 64bit binary for linux dynamically linked against SDL2, should work in most distros.</tr>
                <tr><td><a href='binaries/ctx-x86_64-static'>ctx-x86_64-static</a><td>512K</td><td>ELF 64bit static linux binary - should work in more distros, but has only /dev/fb0 and braille rendering.</tr>
        </table>


<h2 id='license'>license and funding</h2>
<p> The terminal is available under <a
        href='https://www.gnu.org/licenses/gpl-3.0.en.html'>GPLv3+</a>, and
ctx.h is available under <a
        href='https://www.gnu.org/licenses/lgpl-3.0.en.html'>LGPLv3+</a> you
can encourage continued development of ctx and dissimilar technologies by
financially supporting its developer, if the <a
        href='https://pippin.gimp.org/'>authors</a> income through  <a
        href='https:/pippin.gimp.org/funding/'>patreon</a> and similar is above
4000USD per month for a year, or a similar amount in shorter time the protocol
and rasterizer parts of ctx will be relicensed under the <a
href='https://opensource.org/licenses/ISC'>ISC license</a>.  </p>

        <h2 id='bugs'>bugs</h2>
        <ul>
          <li>clip does not clip event boxes/shapes</li>
          <li>clip is not well behaved across save/restore</li>
          <li>arc not well behaved for edge-cases</li>
          <li>flicker of vector uis in terminal with low bandwidth</li>
          <li>pastes are without newlines/tabs</li>
          <li>in_fill is using bounding box - and most reliably works with rectangle.</li>
          <li>radial gradient is only using one center</li>
          <li>dimensions of drop-shadow are not transformed</li>
          <li>some terminal escape sequences should be recognized
          also in ctx-mode, this would give a way of setting colors
          from terminal palette.</li>
        </ul>
        <h2 id='roadmap'>semi-ordered roadmap / wishlist</h2>
	<ul>
        <li>improved performance</li>
        <li>swap uses of cairo in <a href='http://gegl.org'>GEGL</a> with ctx</li>
        <li>diff of frames in terminal protocol</li>
        <li>ICC color management (provisions have been made in the API for this,
                but RGBtoRGB and CMYKtoRGB RGBtoCMYK conversions are currently
                done naively, instead of using <a href='http://gegl.org/babl/'>babl</a>.)</li>
        <li>texture upload as part of ctx syntax</li>
        <li>websockets + js + HTML5 Canvas renderer</li>
        <li>wayland backend</li>
        <li>bindings to a javascript engine like quickjs, for running canvas js content as
            apps.</li>
        <li>(optional) use of floating point instead of fixed point in rasterizer.</li>
	<li>glyph fallback</li>
        <li>faster 1d-gaussian blur for shadow blur</li>
	<li>gradients: use both circle centers</li>
        <li>stroking
          <ul>
            <li>reimplement as a stroke_to_path</li>
	    <li>miter limit (unless round joins are used, all corners are mitered now)</li>
            <li>dash pattern</li>
          </ul>
        </li>
        <li>SVG/HTML parser renderer (in progress, from mrg)</li>
        <li>DRM backend</li>
        <li>PDF/SVG generation (can already be done through cairo integration)</li>
        <li>Add API for integrating device-N with RGB/CMYK through <a href='http://pippin.gimp.org/color-simulator/'>coloritto</a></li>
        <li>32bit float coverage from rasterizer - right now we support 32f images; but composite them with 8bit alpha masks.</li>
        <li>More SIMD code (the common RGBA8 cases for AVX2 are the only bit
            covered thus far, for floating point formats making the
            existing code more autovectorizer friendly is a priority.)</li>
        <li>A GPU renderer, using pathfinder or similar HTML5 2d canvas capable
                library.
        </li>
	</ul>

        <h3 id='example'>example code</h3>
<pre>

#include &lt;stdint.h&gt;

#include "<a href='ctx-font-regular.h'>ctx-font-regular.h</a>"

#define CTX_IMPLEMENTATION

#include "<a href='ctx.h'>ctx.h</a>"

#define WIDTH    72
#define HEIGHT   24

uint8_t pixels[WIDTH*HEIGHT*4];

int main (int argc, char **argv)
{
  char *utf8 = "hello\nctx\n";
  Ctx *ctx = ctx_new_for_framebuffer (
    pixels, WIDTH, HEIGHT, WIDTH*4,
    CTX_FORMAT_RGBA8);

  ctx_rgba        (ctx, 0.5, 0.5, 0.5, 1);
  ctx_rectangle   (ctx, 0, 0, 80, 24);
  ctx_fill        (ctx);
  ctx_move_to     (ctx, 10, 9);
  ctx_font_size   (ctx, 12);
  ctx_line_width  (ctx, 2);
  ctx_rgba        (ctx, 0, 0, 0, 1);
  ctx_text_stroke (ctx, utf8);
  ctx_rgba        (ctx, 1,0, 1.0, 1.0, 1.0);
  ctx_move_to     (ctx, 10, 9);
  ctx_text        (ctx, utf8);
  ctx_free        (ctx);

  static char *utf8_gray_scale[]={" ","░","▒","▓","█","█", NULL};
  int no=0;
  for (int y= 0; y &lt; HEIGHT; y++)
  {
    for (int x = 0; x &lt; WIDTH; x++, no+=4)
      printf ("%s", utf8_gray_scale[5-(int)CTX_CLAMP(pixels[no+1]/255.0*6.0, 0, 5)]);
    printf ("\n");
  }

  return 0;
}
</pre>
which outputs (the rightmost column of pixels is a bug):
<pre>
~/src/ctx/tests$ ./test-size 
▓▓▓▓▓▓▓▓▓▓▓█▓▓▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓██▓▓█ █▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓██ ██████████▓██▓▓▓██▓▓██▓████▓▓█████▒███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓█░  ░█ ██░░ ░██ █▓█ █   ▓█▒  ███   ▓▓   █▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓██ ███ ██ ▓█░██░███░█▓▓██▓░██░██░████▒███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█ █▓█ ██░██▓▓█▓▒█▒▓█▓▒██░▓██░▓█ ▓███▒██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█ █▓█ ██░██▓▓██ █ ██▓▓██░▒▓▓▓███▒░▒█▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█ ███ ██░██▓▓██▒░▒██▓▓██▒▒████████░█▒███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓█▒░▒█ ██░██▓▓██▓ █▓██░░██░░▒░█▓░▒░▓██░░█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓█████▓██▓▓██▓██ █▓▓████▓██████████▓████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓ █▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓▓▓▓▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█ █▓▓▓▓▓▓▓▓▓▓▓▓▓██░░█▓▓▓▓▓▓▓▓▓▓▓█▒▓█▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓████▓▓▓█████ ███▓▓▓████▓▓▓▓█░███████▓▓████▓█▒▓███▓▓████▓▓████
▓▓▓▓▓▓▓▓▓▓██▒▒▓███   ▓█ ▒ ░█▓█▒  ██▓▓█▒  ░█▓  ████  ▒██▒░  ███   ▓██   █
▓▓▓▓▓▓▓▓▓██░██▒██▒▓████ ▓█▒▓█▓▒██░█▓▓██░███░██░██░██▒▓█▒░██░█████░██████
▓▓▓▓▓▓▓▓▓█▓▒██▓▒█ █▓▓▓█ ███▒█░███░█▓▓▓█░██▓▓██▓▓█ ███░█▒▓██▒███▓▓░▓███░█
▓▓▓▓▓▓▓▓▓█▓▒█████ █▓▓▓█ ███▒█░█▓█░█▓▓▓█░██▒▓██▓▓█░███░█▒▓██▒▓█ ██▒▓██░▓█
▓▓▓▓▓▓▓▓▓█▓░█████░█████ ███▒█░▓██ █▓▓▓█░██▓░██░██ ██▓░█▒▒██░██░██░▓█▒▒██
▓▓▓▓▓▓▓▓▓▓█▓░▒░▓██ ▒░██ ███▒██░░ ▓█▓▓▓█░█▓█▒  ▒██▓ ░░██▒░▒░▒██░░░▒▓█ ▒▒█
▓▓▓▓▓▓▓▓▓▓▓█████▓███████▓▓██▓▓████▓▓▓▓▓██▓▓████▓▓████▓██████▓▓██████████
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█
</pre>

<p>To fetch, build, and run ctx, and an example similar to the above
run the following:

<pre>
mkdir foo;cd foo;wget http://ctx.graphics/{ctx.h,ctx-font-regular.h,hello.c};make hello &amp;&amp; ./hello</pre>
</p>
              </div>
      </body>
</html>
