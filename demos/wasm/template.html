<html>
        <head>
         <title>file</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <script src="./file.js"></script>
        <script>
                function windowToCanvas(canvas, x, y) {
   var bbox = canvas.getBoundingClientRect();

   return { x: (x - bbox.left) * (canvas.width  / bbox.width),
            y: (y - bbox.top)  * (canvas.height / bbox.height)
          };
}
         function setDim(dim)
         {
            var canvas = document.getElementById('c');
            var w = parseInt(dim.split('x')[0]);
            var h = parseInt(dim.split('x')[1]);
            _ctx_pause=1;
            setTimeout(function(){
            c.width=w;
            c.height=h;
            if (dim.split(':')[1] == 'sharp')
              c.style='image-rendering: sharp; image-rendering: -webkit-optimize-contrast;  image-rendering: -moz-crisp-edges; width: 50%;'
            else
              c.style='width:50%;';
            _ctx_pause=0;
                            }, 100);
         }

         function setSmoothing(smoothing)
         {
            var c = document.getElementById('c');
            if (smoothing)
              c.style = "width: 100%;";
            else
              c.style = "image-rendering: sharp; image-rendering: -webkit-optimize-contrast;  image-rendering: -moz-crisp-edges; width: 100%;"
         }


         function setDemo(demo)
         {
            var textarea = document.getElementById('input');
            if (demo == 'demo')
              textarea.style = 'display:none;';
            else 
              textarea.style = 'display:block;width:100%';
            var script = '';
            switch (demo)
            {
              default:
              case 'demo': script='demo'; break;
                                            case 'arcs':script=`



rectangle 0 0 100% 100% fill

rgb 1 0 0

M 10,30
       A 20,20 0,0,1 50,30
       A 20,20 0,0,1 90,30
       Q 90,60 50,90
       Q 10,60 10,30  z
stroke

rgb 0 1 0
M 10 50
Q 25,25 40,50
           t 30,0 30,0 30,0 30,0 30,0
stroke

gray 0.5
               M 10 315
           L 110 215
           A 36 60 0 0 1 150.71 170.29
           L 172.55 152.45
           A 30 50 0 0 1 215.1 109.9
           L 315 10 stroke

gray 0

M 20 50  L 50 50  A 40 40 0 0 0 150 50 L 200 50  stroke

translate 0 20

M 20 50  L 50 50  A 50 50 0 0 0 150 50 L 200 50  stroke
               
translate 0 20

M 20 50  L 50 50  A 60 60 0 0 0 150 50 L 200 50  stroke



translate 0 60
M 20 50  L 50 50  A 40 40 0 0 1 150 50 L 200 50  stroke

translate 0 20

M 20 50  L 50 50  A 50 50 0 0 1 150 50 L 200 50  stroke
               
translate 0 20

M 20 50  L 50 50  A 60 60 0 0 1 150 50 L 200 50  stroke


translate 230 -140


M 20 50  L 50 50  A 40 40 0 1 0 150 50 L 200 50  stroke

translate 0 20

M 20 50  L 50 50  A 50 50 0 1 0 150 50 L 200 50  stroke
               
translate 0 20

M 20 50  L 50 50  A 60 60 0 1 0 150 50 L 200 50  stroke

translate 0 60
M 20 50  L 50 50  A 40 40 0 1 1 150 50 L 200 50  stroke

translate 0 20

M 20 50  L 50 50  A 50 50 0 1 1 150 50 L 200 50  stroke
               
translate 0 20

M 20 50  L 50 50  A 60 60 0 1 1 150 50 L 200 50  stroke

translate 0 200

rgb 1 0 0      M 6,10 A 6 4 10 1 0 14 10 stroke
rgb 0 1 0      M 6,10 A 6 4 10 1 1 14,10 stroke
rgb 1 0 1      M 6,10 A 6 4 10 0 1 14,10 stroke
rgb 1 0.5 0.5  M 6,10 A 6 4 10 0 0 14,10 stroke


translate 100 0

rgb 1 0 0      M 6,10 A 6 4 0 1 0 14 10 stroke
rgb 0 1 0      M 6,10 A 6 4 0 1 1 14,10 stroke
rgb 1 0 1      M 6,10 A 6 4 0 0 1 14,10 stroke
rgb 1 0.5 0.5  M 6,10 A 6 4 0 0 0 14,10 stroke
               
               `;break;
              case 'aa': script=`
rgb 1 1 1 rectangle 0 0 100% 100% fill

rgb 0 0 0

fontSize 10
moveTo 2 10
text 'expect sharp'

rectangle 10 15 1 10
fill

rectangle 10 15 10 1
fill

rectangle 10 30 1 1
fill

rectangle 12 30 2 2
fill

rectangle 16 30 3 3
fill

rectangle 21 30 4 4
fill


moveTo    30  15
relLineTo 10  0
relLineTo 0   1
relLineTo -10 0
fill


moveTo    100  25.2
relLineTo 10  0
relLineTo 0   1
relLineTo -10 0
fill

moveTo    110  30.4
relLineTo 10  0
relLineTo 0   1
relLineTo -10 0
fill

moveTo    110  35.5
relLineTo 10  0
relLineTo 0   1
relLineTo -10 0
fill

moveTo    110  40.6
relLineTo 10  0
relLineTo 0   1
relLineTo -10 0
fill

moveTo    110  45.8
relLineTo 10  0
relLineTo 0   1
relLineTo -10 0
fill

moveTo    25  15
relLineTo 1   0
relLineTo 0   1
relLineTo -1  0
fill

moveTo    25  18
relLineTo 2   0
relLineTo 0   2
relLineTo -2  0
fill

moveTo    30  18
relLineTo 3   0
relLineTo 0   3
relLineTo -3  0
fill

moveTo    130.5  48.5
relLineTo 3   0
relLineTo 0   3
relLineTo -3  0
fill

moveTo    35  18
relLineTo 2   0
relLineTo 0   1
relLineTo -2  0
fill

moveTo    40  18
relLineTo 1   0
relLineTo 0   2
relLineTo -1  0
fill

moveTo    45  18
relLineTo 1   0
relLineTo 0   3
relLineTo -1  0
fill

moveTo    50  18
relLineTo 3   0
relLineTo 0   1
relLineTo -3  0
fill

moveTo    55 15
relLineTo 0  10
relLineTo 1   0
relLineTo 0 -10
fill


moveTo 70 10
text 'expect fuzzy'

rectangle 70.5 15.5 1 10
fill

rectangle 70.5 15.5 10 1
fill

rectangle 90 30 3 3.5
fill

rectangle 80 30 3.5 3.5
fill


rectangle 80.5 40.5 3 3
fill

rectangle 80.0 50 3 1.5
fill

rectangle 80.0 57 3 0.5
fill

moveTo    100.5  15.5
relLineTo 10  0
relLineTo 0   1
relLineTo -10 0
fill

moveTo    120.5 15
relLineTo 0  10
relLineTo 1   0
relLineTo 0 -10
fill

lineWidth 1

rectangle 10.5 50.5 1 1
stroke

rectangle 13.5 50.5 2 2
stroke

rectangle 17.5 50.5 3 3
stroke

rectangle 22.5 50.5 4 4
stroke

lineWidth 2

rectangle 10 70 1 1
stroke

rectangle 14 70 2 2
stroke

rectangle 19 70 3 3
stroke

rectangle 25 70 4 4
stroke

lineWidth 2.5
rgb 0 0 0
rectangle 110 50 10 10
stroke

lineWidth 2

rgb 0 0 0
moveTo 10 40
lineTo 20 40
stroke

moveTo 45 30
lineTo 45 40
stroke

moveTo 75.5 30.5
lineTo 75.5 40.5
stroke

moveTo 90.5  40.5
lineTo 100.5 40.5
stroke

translate 0 20.0

lineWidth 1
rgb 0 0 0

moveTo 10 40.5
lineTo 20 40.5
stroke

moveTo 45.5 30
lineTo 45.5 40
stroke
gray 0

moveTo 75 30.5
lineTo 75 40.5
stroke

moveTo 90.5  40
lineTo 100.5 40
stroke `;break;
case 'landscape': script=`
linearGradient 0 0 0 80%
gradientAddStop 0 0 0 1 1
gradientAddStop 1 1 1 1 1
rectangle 0 0 100% 100%
fill

save
translate 50% 58%
scale 1.3 0.4
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 0.8
gradientAddStop 1 1 1 1 0.2
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 70% 80%
scale 1.0 1.0
radialGradient 0% 0% 55% 0% 0% 70%
gradientAddStop 0.0 0.0 0 0 0.0
gradientAddStop 0.01 1.0 0 0 0.45
gradientAddStop 0.1 1.0 0 1.0 0.45
gradientAddStop 0.13  1.0 0 1.0 0.45
gradientAddStop 0.25 0 0 1.0 0.45
gradientAddStop 0.35 0 1.0 1.0 0.45
gradientAddStop 0.4 0 1.0 1.0 0.45
gradientAddStop 0.5 0 1.0 0 0.45
gradientAddStop 0.6 1.0 1.0 0 0.45
gradientAddStop 0.7 1.0 0.92 0 0.45
gradientAddStop 0.95 1.0 0 0 0.45
gradientAddStop 0.99 0.0 0 0 0.0
gradientAddStop 1.0 0.0 0 0 0.0

beginPath
arc 0% 0% 70% 0 6.3 0
fill
restore

save
translate 30% 53%
scale 1.3 0.4
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 0.8
gradientAddStop 1 1 1 1 0.2
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore


save
translate 50% 100%
scale 1.3 1.3
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 0.4 1 0.4 1
gradientAddStop 1 0 0.2 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 20% 110%
scale 1.6 1.6
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 0.4 1 0.4 1
gradientAddStop 1 0 0.2 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 80% 110%
scale 1.6 1.6
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 0.4 1 0.4 1
gradientAddStop 1 0 0.2 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore


save
translate 55% 132%
scale 1.9 1.9
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 0.4 1 0.4 1
gradientAddStop 1 0 0.2 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore


save
translate 30% 30%
scale 0.2 0.2
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 1
gradientAddStop 1 0 0 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 30% 40%
scale 0.3 0.3
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 1
gradientAddStop 1 0 0 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 30% 70%
scale 0.5 0.5
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 1
gradientAddStop 1 0 0 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 40% 60%
scale 0.5 0.5
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 1
gradientAddStop 1 0 0 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 20% 60%
scale 0.5 0.5
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 1
gradientAddStop 1 0 0 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore

save
translate 20% 60%
scale 0.15 0.15
radialGradient -5% -10% 10% 40% 40% 50%
gradientAddStop 0 1 1 1 1
gradientAddStop 1 0 0 0 1
beginPath
arc 0% 0% 30% 0 6.3 0
fill
restore


save

rgb 1 0 0
arc 64% 60% 10% 0 6.4 0
fill
rgb 0 1 0
arc 55% 58% 10% 0 6.4 0
fill
rgb 0 0 1
arc 72% 66% 10% 0 6.4 0
fill
gray 0.5
arc 60% 90% 10% 0 6.4 0
fill

cmyka 1 0 0 0 0.5
arc 53% 72% 20% 0 6.4 0
fill
cmyka 0 1 0 0 0.5
arc 61% 40% 30% 0 6.4 0
fill
cmyk 0 0 1 0
arc 76% 86% 10% 0 6.4 0
fill
cmyk 1 0 0 .5
arc 80% 60% 10% 0 6.4 0
fill
rgba 0 0 0 1

restore

save
  rotate 0.0
  fontSize 18^

  rgba 1.0 1.0 1.0 1
  moveTo 20^ 96^
  shadowBlur 3.5^
  rgb shadowColor 0 0 0 1.0
  shadowOffsetX 1^
  shadowOffsetY 1^
  text "ctx vector graphics"
restore

save
  fontSize 0.8@
  moveTo 0.4@ 1@
  gray 0
  text "black\n"
  gray 1.0
  text "white\n"
  cmyk 1 0 0 0
  text "cyan\n"
  cmyk 0 1 0 0
  text "magenta\n"
  cmyk 0 0 1 0
  text "yellow\n"
  cmyk 1 1 1 1
  text "cmyk overprint\n"
  rgb 1 0 0
  text "red\n"
  rgb 0 1 0
  text "green\n"
  rgb 0 0 1
  text "blue\n"
  rgba 1 0 0 0.5
  text "red 0.5 alpha\n"
  cmyka 0 1 0 0 0.5
  text "magenta 0.5 alpha\n"

restore
save
  beginPath
  translate 55% 48%
  rotate 0.1
  roundRectangle 0 0 40^ 30^ 3^
  gray 0
  fill
  lineWidth 2^
  grayS 1
  roundRectangle 0 0 40^ 30^ 3^
  stroke
  gray 1
  fontSize 8^
  moveTo 2^ 9^
  text "$ _"
restore
newPath


save
# ctx logo
translate 5% 10%
scale 80^ 80^
rgba 1 1 1 0.4
m 0.43956786,0.90788066 c 0.0195929,0.0102943 0.0716181,0.0218038 0.10361884,-0.0167646 L 0.93768705,0.37887837 c 0.019925,-0.0342044 -0.00963,-0.0544608 -0.0308834,-0.0508084 -0.17965502,0.0285588 -0.35466092,-0.055125 -0.45096394,-0.21253089 -0.0176003,-0.02988716 -0.0594422,-0.01560777 -0.0594422,0.0139473 0,0.0591101 0.003321,0.49845135 0.001991,0.70699722 0.00039042,0.0283487 0.0157362,0.0529866 0.0408456,0.070733 F
f 0.0525 0 0.9905 0
p 0.0 1.0 1.0 0.66 1.0
p 0.2 1 0.66 0 1.0
p 0.5 1 0.0 0 1.0
p 1.0 0.4 0.0 0.53 1.0
m 0.39772584,0.91850721 h -0.0664159 c -0.15408489,0 -0.27894675,-0.12486192 -0.27894675,-0.2789468 0,-0.15408489 0.12486186,-0.27861466 0.27894675,-0.27894675 l 0.18585599,0.0000662 c 0.0111839,0.00017138 0.0158287,0.001542 0.0263337,0.0134822 0.11733258,0.14373102 0.3018009,0.36870115 0.3942639,0.49195316 0.0185394,0.0332794 -0.0106225,0.0505515 -0.0228143,0.0505207 F
f 0.697 0.17 0.4318 0.884
p 0.0 0.26 0.26 1 1.0
p 0.3 0 1 1 0.4
p 1.0 0 1 0.26 1.0
m 0.43956786,0.90788066 c 0.0195929,0.0102943 0.0716181,0.0218038 0.10361884,-0.0167646 L 0.93768705,0.37887837 c 0.019925,-0.0342044 -0.00963,-0.0544608 -0.0308834,-0.0508084 -0.17965502,0.0285588 -0.35466092,-0.055125 -0.45096394,-0.21253089 -0.0176003,-0.02988716 -0.0594422,-0.01560777 -0.0594422,0.0139473 0,0.0591101 0.003321,0.49845135 0.001991,0.70699722 0.0039042,0.0283487 0.0157362,0.0529866 0.0408456,0.070733 F
restore`;break;
case 'ctx logo':
script=`

rectangle 0 0 1000 1000
rgba 1 1 1 1 fill
scale 100^ 100^
rgba 1 1 1 0.4
m 0.486,0.907 c 0.019,0.0102 0.0716,0.021 0.103,-0.016 L 0.937,0.378 c 0.019,-0.034 -0.009,-0.054 -0.031,-0.0508 -0.179,0.028 -0.354,-0.055 -0.450,-0.212 -0.0176,-0.0298 -0.0594,-0.0156 -0.059,0.0139 0,0.0591 0.003,0.498 0.002,0.706 0.0004,0.028 0.0157,0.052 0.040,0.070 F
f 0.0525 0 0.9905 0
p 0.0 1.0 1.0 0.66 1.0
p 0.2 1 0.66 0 1.0
p 0.5 1 0.0 0 1.0
p 1.0 0.4 0.0 0.53 1.0
m 0.397,0.918 h -0.066 c -0.154,0 -0.278,-0.124 -0.278,-0.278 0,-0.154 0.124,-0.278 0.278,-0.278 l 0.185,0.000 c 0.0111,0.0002 0.0158,0.001 0.026,0.013 0.117,0.143 0.301,0.368 0.394,0.491 0.018,0.033 -0.010,0.050 -0.022,0.050 F
f 0.697 0.17 0.4318 0.884
p 0.0 0.26 0.26 1 1.0
p 0.3 0 1 1 0.4
p 1.0 0 1 0.26 1.0
m 0.4395,0.907 c 0.0195,0.0102 0.0716,0.0218 0.1036,-0.0167 L 0.937,0.378 c 0.019,-0.034 -0.009,-0.054 -0.030,-0.050 -0.179,0.028 -0.354,-0.005 -0.450,-0.212 -0.0176,-0.0298 -0.059,-0.015 -0.059,0.013 0,0.059 0.003,0.498 0.001,0.706 0.003,0.028 0.015,0.052 0.040,0.070 F`;
    break;
case 'anim':
  script=`
               [5]
rgb 0 0 0
rectangle 0 0 100% 100%
fill
gray 1
M 50% 50%
textAlign center
fontSize (0=1 5=20)%
x "welcome"

[3]
rgb 0 0 0
rectangle 0 0 100% 100%
fill
gray 1
M 50% 50%
textAlign center
fontSize (0=1 3=20)%
x "to"


[3]
rgb 0 0 0
rectangle 0 0 100% 100%
fill
gray 1
M 50% 50%
textAlign center
fontSize (0=1 3=20)%
x "ctx vectors"


[5]
rgb 0 0 0
rectangle 0 0 100% 100%
fill

rgb 1 1 0 rectangle 40 40 40 40 fill
               `;
                                            break;
case 'foo': script=`scale 2.2
linearGradient 0 0 100% (0=100 40=50 70=20)%
gradientAddStop 0 1 1 1 0
gradientAddStop 1 (0=1 30=0) 0 (0=0 20=0.5) 1

rectangle 0 0 100% 100% fill


fontSize 7.9%
rgba 1 1 1 .4  M 5% 15% x "f(0=0 100=100)"

rgba 1 1 0 (0=0 15=1 30=0) r 40 40 40 (    0=10   30=770   )   fill
scale 2 2
             rotate .01

r  4 4 24 24    100 100 4 4 80 80 2 2  fill`;break;
              }
            textarea.value=script;
            _reset_time();
         }

        </script>
        </head>
        <body>
                <div>
                <select id='demo' onchange='setDemo(this.value);'>
                    <option value='demo'>demo</a>
                    <option value='ctx logo'>ctx logo</a>
                    <option value='landscape'>landscape</a>
                    <option value='anim'>anim</a>
                    <!--<option value='foo'>foo</a>
                    <option value='aa'>aa</a>-->
                    <option value='arcs'>arcs</a>
                </select>
                <!--
                <select id='dim' onchange='setDim(this.value);'>
                    <option value='160x80:sharp'>160x80</a>
                    <option value='128x128:sharp'>128x128</a>
                    <option value='160x120:sharp'>160x120</a>
                    <option value='320x240:sharp'>320x240</a>
                    <option value='640x480:sharp' selected>640x480</a>
                    <option value='640x480'>640x480 smoothed</a>
                    <option value='800x600:sharp'>800x600</a>
                    <option value='800x600'>800x600 smoothed</a>
                    <option value='1920x1080:sharp'>1920x1080</a>
                    <option value='1920x1080'>1920x1080 smoothed</a>
                </select>
                -->
                <select id='scene' title='loop a single scene, or blank for all'>
                    <option value='-1' selected> </a>
                    <option value='0'>0</a> <option value='1'>1</a> <option value='2'>2</a>
                    <option value='3'>3</a> <option value='4'>4</a> <option value='5'>5</a>
                    <option value='6'>6</a> <option value='7'>7</a> <option value='8'>8</a>
                    <option value='9'>9</a> <option value='10'>10</a> <option value='11'>11</a>
                    <option value='12'>12</a> <option value='13'>13</a> <option value='14'>14</a>
                    <option value='15'>15</a> <option value='16'>16</a> <option value='17'>17</a>
                    <option value='18'>18</a> <option value='19'>19</a> <option value='20'>20</a>
                    <option value='21'>21</a> <option value='22'>22</a> <option value='23'>23</a>
                    <option value='24'>24</a> <option value='25'>25</a> <option value='26'>26</a>
                    <option value='27'>27</a> <option value='28'>28</a> <option value='29'>29</a>
                </select>
                <input type='checkbox' title='visualize bounding rects of redrawn areas' id='damagecontrol'>damage control</input>
                <input type='checkbox' title='whether the browser should show canvas pixels or a smoothing during resampling' id='smoothing'
                onchange='setSmoothing(this.checked);'
                >smoothing</input>
                <br/>
                <textarea style='display:none;' id='input' name='script' rows='10' 
>demo
                </textarea>
                <br/>
           </div>
          <canvas 
              style="image-rendering: sharp; image-rendering: -webkit-optimize-contrast;  image-rendering: -moz-crisp-edges; width: 100%;"
                  id='c' width='640' height='480' tabindex='0'></canvas>
          </p>
        </body>

</html>
